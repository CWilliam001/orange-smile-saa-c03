Scalability & High Availability

Scalability = an application / system can handle greater loads by adapting
    Vertical Scalability
        Increasing size of the instance
        Eg: 4GB memory => 8GB memory
        Common for non distributed systems such as database like RDS, ElastiCache
        Theres usually a limit to how much you can vertically scale (hardware limit)
    Horizontal Scalability
        Increasing the number of instances / systems for your application
        Implies to distributed systems
        Common for web applications / modern applications

High Availability
    Usually goes hand in hand with horizontal scaling
    Running your application / system in at least 2 data centers (AZ)
    The goal of high availability is to survive a data center loss
    Can be passive (for RDS Multi AZ)
    Can be active (for horizontal scaling)





Load Balancing
    Load Balancers are servers that forward traffic to multiple servers downstream
    Spread load across multiple downstream instances
    Expose a single point of access (DNS) to your application
    Seamlessly handle failures of downstream instances
    Do regular health checks to your instances
    Provide SSL termination (HTTPS) for your websites
    Enforce stickiness with cookies
    High availability across zones
    Separate public traffic from private traffic

ELB
    Managed load balancer
        Guarantees that it will be working
        Takes care of upgrades, maintenance, high availability
        Provides only a few configuration knobs
    It costs less to setup your own load balancer but it will be a lot more effort on your end
    Integrated with many AWS offerings / services
    EC2, EC2 Auto Scaling Groups. Amazon ECS
    AWS Certificate Manager (ACM), CloudWatch
    Route53, AWS WAF, AWS Global Accelerator

Health Checks
    Crucial for load balancers
    Enable the load balancer to know if instances it forwards traffic to are available to reply to requests
    The health check is done on a port and a route (/health is common)
    If response !== 200 (ok), then the instance is unhealth

Types of load balancer on AWS
    Classic Load Balancer (Deprecated)
        Compatible to: HTTP, HTTPS, TCP, SSL
    Application Load Balancer
        Compatible to: HTTP, HTTPS, WebSocket
        Routing tables to differenct target groups
            Based on path in URL (example.com/users & example.com/posts)
            Based on hostname in URL
            Based on Query String, Headers
        Great fit for micro services & container based applicaature to redirect to a dynamic port in ECS
       tion (Docker & ECS)
        Has a port mapping fe In comparison, we'd need multiple CLB per application
    Network Load Balancer
        Compatible to: TCP, TLS, UDP (Layer 4)
        ForwardTCP & UDP traffic to your instances
        Handle millions of request per seconds
        Ultra-low latency
        Has one static IP per AZ, and supports assigning Elastic IP (helpful for whitelisitng specific IP)
        Used for extreme performance, TCP or UDP traffic
        Health checks support the TCP, HTTP and HTTPS Protocols
    Gateway Load Balancer
        Operates at layer 3 (Network Layer) - IP Protocol
        Deploy, scale, and manage a fleet of 3rd party network virtual appliances in AWS
        Firewalls, Intrusion Detection and Prevention Systems, Deep Packet Inspection Systems, payload manipulation
        Combines the following functions:
            Transparent Network Gateway - single entry / exit for all traffic
            Load Balancer - distributes traffic to your virtual appliances
        Uses the GENEVE protocol on port 6081




Sticky Sessions (Session Affinity)
    Possible to implement stickiness so that the same client is always redirected to the same instance behind the load balancer
    Works for Classic Load Balancer, Application Load Balancer, and Network Load Balancer
    The "cookie" used for stickiness has an expiration date you control
    Make sure the user doesnt lose his session data
    Enabling stickiness may bring imbalance to the load over the backend EC2 instances

Cookie Names
    Application-based Cookies
        Custom Cookie
            Generated by the target
            Can include any custom attributes required by the application
            Cookie name must be specified individually for each target group
            Don't use AWSALB, AWSALBAPP, AWSALBTG (reserved for use by the ELB)
        Application Cookie
            Cookie generated by the Load Balancer
            Cookie name is AWSAPB
    Duration-based Cookies
        Cookie generated by the Load Balancer
        Cookie name is AWSALB, for ALB, AWSELB for CLB